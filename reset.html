<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordrobe Reset Tool</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background: #fee2e2; color: #b91c1c; display: flex; flex-direction: column; justify-content: center; height: 100vh; }
        h1 { margin-bottom: 20px; font-size: 1.5rem; }
        button { background: #ef4444; color: white; border: none; padding: 15px 30px; font-size: 1.2rem; font-weight: bold; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.95); }
        p { margin-top: 20px; font-size: 0.9rem; line-height: 1.5; }
    </style>
</head>
<body>

    <h1>âš ï¸ å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆãƒ„ãƒ¼ãƒ«</h1>
    
    <button onclick="resetApp()">ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ</button>

    <p>ã“ã®ç«¯æœ«ã® Service Workerã€<br>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’<br>å…¨ã¦å‰Šé™¤ã—ã¾ã™ã€‚</p>
    <div id="log" style="margin-top:20px; font-family:monospace; background:white; padding:10px; border-radius:8px; text-align:left; min-height:100px;">å¾…æ©Ÿä¸­...</div>

    <script>
        async function resetApp() {
            const logEl = document.getElementById('log');
            const log = (msg) => { logEl.innerHTML += `<div>${msg}</div>`; console.log(msg); };
            
            logEl.innerHTML = '';
            log('é–‹å§‹ã—ã¾ã™...');

            try {
                // 1. Service Workerã®å‰Šé™¤
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        await registration.unregister();
                        log('âœ… SWå‰Šé™¤: ' + registration.scope);
                    }
                    if (registrations.length === 0) log('â„¹ï¸ å‰Šé™¤ã™ã‚‹SWã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }

                // 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å‰Šé™¤
                const cacheKeys = await caches.keys();
                for (let key of cacheKeys) {
                    await caches.delete(key);
                    log('âœ… Cacheå‰Šé™¤: ' + key);
                }
                if (cacheKeys.length === 0) log('â„¹ï¸ å‰Šé™¤ã™ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ');

                // 3. IndexedDB (Dexie) ã®å‰Šé™¤
                // â€»ã‚ãªãŸã®DBå 'WordloopDB' ã‚’æŒ‡å®šã—ã¦æ¶ˆã—ã¾ã™
                const dbs = await window.indexedDB.databases ? await window.indexedDB.databases() : [{name: 'WordloopDB'}];
                for (let db of dbs) {
                    if (db.name) {
                        const req = window.indexedDB.deleteDatabase(db.name);
                        req.onsuccess = () => log('âœ… DBå‰Šé™¤æˆåŠŸ: ' + db.name);
                        req.onerror = () => log('âŒ DBå‰Šé™¤å¤±æ•—: ' + db.name);
                        req.onblocked = () => log('âš ï¸ DBå‰Šé™¤ãƒ–ãƒ­ãƒƒã‚¯ (ã‚¿ãƒ–ã‚’é–‰ã˜ã¦ãã ã•ã„)');
                    }
                }

                log('------------------');
                log('ğŸ‰ å®Œäº†ã—ã¾ã—ãŸï¼');
                log('wordrobe.htmlã«æˆ»ã£ã¦ãã ã•ã„');

            } catch (e) {
                log('âŒ ã‚¨ãƒ©ãƒ¼: ' + e.message);
            }
        }
    </script>
</body>
</html>
